<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">
    <!-- Author:  -->
    <!-- date:    14.07.2023 -->
    <grid name="call-center.ticket.list.grid" title="Reference card" model="com.axelor.apps.helpdesk.db.Ticket"
          edit-icon="true" orderBy="-createdOn">
        <field name="ticketSeq" title="KO number"/> <!--поле 'Номер КО'-->
        <field name="userContact.fullName"/> <!--поле 'Полное имя'-->
        <field name="subject" title="Phone number"/> <!--поле '№ телефона'-->
        <field name="anonymity" selection="call-center.anonimity.state"/> <!--поле 'Анонимность'-->
        <field name="responsible"/> <!--поле 'Ответственный'-->
        <field name="formAppeal"/> <!--поле 'Обращение по форме'-->
        <field name="typeTreatment"/> <!--поле 'Вид обращения'-->
        <field name="statusSelect"/> <!--поле 'Статус'-->
        <field name="tasks"/> <!--поле 'Задачи'-->
        <field name="createdOn"/> <!--поле 'Созданный на'-->
    </grid>

    <form width="large" model="com.axelor.apps.helpdesk.db.Ticket" title="Reference card" name="call-center.ticket-form"
          onNew="call-center.ticket-type.form.on-new">
        <panel colSpan="12">
            <panel name="mainPanel" colSpan="6">
                <field name="ticketSeq" title="Sequence number" hidden="true"/>
                <field name="anonymity" title="Anonymity" widget="boolean-select"/>
                <field name="subject" title="Phone" widget="phone" colSpan="12"/>
                <button name="Search" onClick="call-center.ticket-form.search-btn" title="Search" hidden="true"/>
                <field name="userContact" title="Contact" colSpan="12" canView="false">
                    <viewer>
                        <![CDATA[
                            <strong>{{record.lastName}} {{record.firstName}} {{record.middleName}}</strong>
                            <br/>
                            <a href='#'>{{record.email}}</a>
                        ]]>
                    </viewer>
                    <editor colSpan="12">
                        <field name="lastName" colSpan="12"/>
                        <field name="firstName" colSpan="12"/>
                        <field name="middleName" colSpan="12"/>
                        <field name="email" widget="email" colSpan="12"/>
                    </editor>
                </field>

                <field name="formAppeal" title="The form of appeal"/>
                <field name="typeTreatment" title="Type of treatment"/>
                <field name="responsible" canView="false"/>

                <field name="audioRecord" colSpan="6" widget="binary" x-accept="application/ogg"/>
                <field name="audioRecordPlayer" colSpan="6" showTitle="false" readonly="true">
                    <viewer><![CDATA[
                        <div ng-controller="audioRecordPlayer">
                            <audio controls ng-if="audioRecordSrc">
                                <source src="{{audioRecordSrc}}" type="application/ogg">
                                Your browser does not support the audio tag.
                            </audio>
                        </div>
                    ]]></viewer>
                </field>


                <field name="description" colSpan="12"/>

            </panel>
            <panel colSpan="6">
                <field name="ticketTypes" colSpan="12" form-view="ticket-type-simple-form"/>
                <field name="$ticketType" showTitle="false" readonly="true">
                    <viewer><![CDATA[
              <div >
                 <div ng-controller="customModalCtrl">

                  <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop" ng-click="clickBtn()">
                    Launch static backdrop modal
                  </button>

                  <!-- Modal -->
                  <!-- <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true"> -->
                  <div class="questionList-custom-modal" ng-class="classShow">
                  <div class="modal-dialog">


									 <div class="modal-header">
                      <div class="search-questions" ng-if="!question.value && !history.breadcrumbs[history.breadcrumbs.length - 1].questionValueClick && history.breadcrumbs[history.breadcrumbs.length - 1].id !== question.id">
                        <div class="search-questions__block-input">
                          <input type="search" ng-model="searchValue" class="search-questions__input" placeholder="Введите что искали или воспользуйтесь хештэгом" ng-keyup="getSearchQuestions($event.keyCode, searchValue)" />
                          <div class="search-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 -960 960 960" width="32" fill="#988ED6"><path d="M796-121 533-384q-30 26-69.959 40.5T378-329q-108.162 0-183.081-75Q120-479 120-585t75-181q75-75 181.5-75t181 75Q632-691 632-584.85 632-542 618-502q-14 40-42 75l264 262-44 44ZM377-389q81.25 0 138.125-57.5T572-585q0-81-56.875-138.5T377-781q-82.083 0-139.542 57.5Q180-666 180-585t57.458 138.5Q294.917-389 377-389Z"/></svg>
                          </div>
                        </div>

            						<div class="tags-block" ng-if="tags.length !== 0">
             							<ul class="tags-block__ul">
              							<li class="tags-block__item" ng-repeat="tag in tags" ng-click="clickTagItem(tag)" >#{{tag.tag}}</li>
													</ul>
												</div>

                      </div>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" ng-click="exitModal()"><svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="m249-207-42-42 231-231-231-231 42-42 231 231 231-231 42 42-231 231 231 231-42 42-231-231-231 231Z"/></svg></button>
                  	</div>



                  <div ng-class="modalContent">
                    <div>
                        <!--<nav aria-label="breadcrumb">
                          <ol class="breadcrumb">
                            <li class="breadcrumb-item active" aria-current="page" ng-repeat="breadcrumb in history.breadcrumbs">
                                <a href="#" ng-if="$index !== history.breadcrumbs.length - 1" ng-click="clickBreadCrumb($event, breadcrumb, $index)">{{breadcrumb.name}}</a>
                                <span ng-if="$index === history.breadcrumbs.length - 1">{{breadcrumb.name}}</span>
                            </li>
                          </ol>
                        </nav>-->
                    </div>





                    <div class="modal-body">
												<h2 class="modal-title fs-5" id="staticBackdropLabel">{{history.breadcrumbs[history.breadcrumbs.length - 1].name}}</h2>
                        <div ng-if="data.tabs === 'scripts'">

                            <div class="cardBlock" ng-if="data.start === 'hide'">
                                <div class="questionList-card" style="width: 18rem;" ng-repeat="question in questions" ng-click="clickQuestion(question.id)">
                                    <div class="card-body">

                                    	<p class="card-text">{{question.name}}</p>

                                    </div>
                                </div>

                            </div>


                            <div class="question-block" ng-if="data.start === 'show'">
                                <ul class="list-group">

                                    <li ng-repeat="question in questions"  >

                                        <div ng-if="!question.value" ng-click="clickQuestion(question.id)">
																					<div class="list-group-item" >
                                            <label class="form-check-label" for="secondCheckbox" >{{question.name}}</label>
                    											</div>
                                        </div>

                                        <div ng-if="question.value && !history.breadcrumbs[history.breadcrumbs.length - 1].questionValueClick" ng-click="clickQuestion(question.id)">
																					<div class="list-group-item" >
                                            <label class="form-check-label">{{question.name}}</label>
                      										</div>
                                        </div>

                                        <div ng-if="question.value && history.breadcrumbs[history.breadcrumbs.length - 1].questionValueClick && history.breadcrumbs[history.breadcrumbs.length - 1].id === question.id" ng-click="clickQuestion(question.id)">


                      											<div id="questionValue"></div>








																						<h5 class="blockLinks_h5" ng-if="questionFiles">Файлы</h5>
                                            <div class="blockLinks">
                                                <a href="ws/dms/inline/{{file.id}}" class="block_link" ng-repeat="file in questionFiles" target="_blank">{{file.fileName}}</a>
                                            </div>

                                            <div>
                                             <button type="button" class="question-btn btn-selection" ng-click="onClickSave(question.id)">Выбрать</button>
                                           	</div>
                                        </div>


                                    </li>

                                  </ul>
                            </div>


                        </div>


                        <div ng-if="data.tabs === 'createScript'">
                            <div ng-controller="createQuestionCtrl">
                              <form action="#" class="createQuestion">
                               <div class="form-group">
                                 <label for="usr">Name:</label>
                                 <input type="text" class="form-control" ng-class="toggleError" id="usr" ng-model="questionName" ng-change="inputNameChange()">
                                </div>
                                <div class="form-group">
                                  <label for="area1">Value:</label>
                                  <textarea type="text" id="area1" rows="5" style="height: 200px;" ng-model="questionValue"></textarea>
                                 </div>
                                <div class="btn-block">
                                  <button type="button" class="question-btn btn-create-question" ng-click="createQuestion()">Сохранить</button>

                                  <button type="button" class="question-btn btn-create-question" ng-click="hideCreateQuestion()">Отмена</button>

                                 </div>
                              </form>
                            </div>
                        </div>



                    </div>

                  </div>
										 <div class="modal-footer" >
                        <!--<div class="block-btn-create" ng-if="!question.value && !history.breadcrumbs[history.breadcrumbs.length - 1].questionValueClick && history.breadcrumbs[history.breadcrumbs.length - 1].id !== question.id">
                          <button type="button" class="question-btn btn-create-question" ng-click="showCreateQuestion()">
                            <svg xmlns="http://www.w3.org/2000/svg" height="25" viewBox="0 -960 960 960" width="25" fill="#fff" ><path d="M453-280h60v-166h167v-60H513v-174h-60v174H280v60h173v166Zm27.266 200q-82.734 0-155.5-31.5t-127.266-86q-54.5-54.5-86-127.341Q80-397.681 80-480.5q0-82.819 31.5-155.659Q143-709 197.5-763t127.341-85.5Q397.681-880 480.5-880q82.819 0 155.659 31.5Q709-817 763-763t85.5 127Q880-563 880-480.266q0 82.734-31.5 155.5T763-197.684q-54 54.316-127 86Q563-80 480.266-80Zm.234-60Q622-140 721-239.5t99-241Q820-622 721.188-721 622.375-820 480-820q-141 0-240.5 98.812Q140-622.375 140-480q0 141 99.5 240.5t241 99.5Zm-.5-340Z"/></svg>
                            <span class="btn-create-question__text">создать вопрос</span>
                          </button>
                        </div>-->
            						<div ng-if="history.breadcrumbs.length !== 1">
	            						<button type="button" class="question-btn btn-create-question" ng-click="clickBtnFirst()">В начало</button>
												</div>
                        <div class="block-btn-prev-next">
                          <button type="button" class="question-btn btn-prev-next" ng-click="prev()" ng-if="history.prevElems.length !== 0">Назад</button>
                          <button type="button" class="question-btn btn-prev-next" ng-click="prev()" ng-if="history.prevElems.length === 0" disabled>Назад</button>
                          <button type="button" class="question-btn btn-prev-next" ng-click="next()" ng-if="history.nextElems.length !== 0">Вперед</button>
                          <button type="button" class="question-btn btn-prev-next" ng-click="next()" ng-if="history.nextElems.length === 0" disabled>Вперед</button>
                        </div>

                    </div>
                  </div>
                  </div>
                  </div>

            </div>
        ]]></viewer>
                </field>
                <field name="statusSelect" title="Circulation status" selection-in="[4, 5, 6]"/>
                <field name="tasks" colSpan="12"/>
            </panel>
        </panel>
        <panel-mail name="mailPanel">
            <mail-messages limit="6"/>
        </panel-mail>
    </form>

    <action-attrs name="call-center.ticket-type.form.on-new" model="com.axelor.apps.helpdesk.db.Ticket">
        <attribute for="responsible" name="value" expr="eval: __user__"/>
        <attribute for="responsible" name="readonly" expr="true" if="__user__ != null"/>
        <attribute for="statusSelect" name="value" expr="4"/>
    </action-attrs>

    <action-attrs name="call-center.ticket-form.search-btn" model="com.axelor.apps.helpdesk.db.Ticket">
        <attribute for="userContact" name="value"
                   expr="eval: __repo__(UserContact).findByPhoneNumber(subject).fetchOne()"/>
    </action-attrs>

</object-views>